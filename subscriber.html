<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>ðŸ‘‚ Supervisor Subscriber</title>
  </head>
  <body>
    <h2>ðŸ‘‚ Supervisor Subscriber</h2>
    <button id="connect">Start Listening</button>
    <div id="audio-container"></div>

    <script type="module">
      import { Room } from "https://cdn.skypack.dev/livekit-client@2";

      // ðŸ”‘ Token superviseur (subscriber only)
      const token =
        "eyJhbGciOiJIUzI1NiJ9.eyJ2aWRlbyI6eyJyb29tSm9pbiI6dHJ1ZSwicm9vbSI6InJvb206Y29tbWVyY2lhbDoxMCIsImNhblB1Ymxpc2giOmZhbHNlLCJjYW5TdWJzY3JpYmUiOnRydWV9LCJpc3MiOiJBUElhNEVYRDZSUHRwaXoiLCJleHAiOjE3NjEwNzE1NjIsIm5iZiI6MCwic3ViIjoic3VwZXJ2aXNvci0xIn0.O-Cd9HHmGgC_xTL2IuZLd_V86oQz0GIKU6NIobrPWhA";
      const url = "wss://prospection-22s07180.livekit.cloud";

      document.getElementById("connect").onclick = async () => {
        console.log("Connecting to LiveKit as supervisor...");
        const room = new Room();
        
        room.on('trackSubscribed', (track, publication, participant) => {
          console.log('ðŸŽ§ Subscribed to track from:', participant.identity);
          if (track.kind === 'audio') {
            const audioElement = track.attach();
            audioElement.autoplay = true;
            document.getElementById('audio-container').appendChild(audioElement);
          }
        });

        await room.connect(url, token);
        console.log("âœ… Connected as supervisor:", room.localParticipant.identity);
        console.log("ðŸ‘‚ Listening for audio streams...");
      };
    </script>
  </body>
</html>
